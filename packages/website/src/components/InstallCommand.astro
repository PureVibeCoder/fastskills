---
const commands = {
  npm: 'npm install -g skillscontroller',
  brew: 'brew install marovole/tap/skillscontroller'
};
---

<section id="install" class="install-section section-secondary">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">一键安装</h2>
      <p class="section-subtitle">选择你喜欢的包管理器，一条命令即可完成安装</p>
    </div>
    <div class="install-methods grid-auto" style="max-width: 700px;">
      <div class="install-method card">
        <span class="method-label">npm</span>
        <code class="install-command">{commands.npm}</code>
        <button class="btn btn-primary btn-sm copy-button" data-command={commands.npm} data-copy-index="0">
          复制
        </button>
      </div>
      <div class="install-method card">
        <span class="method-label">Homebrew</span>
        <code class="install-command">{commands.brew}</code>
        <button class="btn btn-primary btn-sm copy-button" data-command={commands.brew} data-copy-index="1">
          复制
        </button>
      </div>
    </div>
  </div>
</section>

<style>
  .install-section {
    padding: var(--spacing-2xl) var(--spacing-md);
  }

  .install-methods {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
  }

  .install-method {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-md);
  }

  .method-label {
    font-weight: 600;
    font-size: 0.875rem;
    color: var(--color-text-secondary);
    min-width: 80px;
  }

  .install-command {
    flex: 1;
    font-family: var(--font-mono);
    font-size: 0.9375rem;
    color: var(--color-text);
    background: transparent;
    border: none;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .copy-button {
    white-space: nowrap;
  }

  @media (max-width: 768px) {
    .install-method {
      flex-wrap: wrap;
    }

    .install-command {
      width: 100%;
      order: 2;
      margin-top: var(--spacing-xs);
    }

    .copy-button {
      width: 100%;
      order: 3;
    }
  }
</style>

<script>
  document.querySelectorAll('.copy-button').forEach(button => {
    button.addEventListener('click', async () => {
      const command = button.dataset.command;
      try {
        await navigator.clipboard.writeText(command);
        const originalText = button.textContent;
        button.textContent = '已复制!';
        button.classList.remove('btn-primary');
        button.classList.add('btn-success');
        setTimeout(() => {
          button.textContent = originalText;
          button.classList.remove('btn-success');
          button.classList.add('btn-primary');
        }, 2000);
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    });
  });
</script>
